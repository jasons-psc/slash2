.\" $Id$
.Dd January 26, 2010
.Dt MSCTL 8
.ds volume PSC \- SLASH Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm msctl
.Nd
.Tn SLASH
file system mount daemon runtime control
.Sh SYNOPSIS
.Nm msctl
.Op Fl HIR
.\" .Op Fl c Ar cmd
.Op Fl f Ar cmd
.Op Fl h Ar table
.Op Fl i Ar iostatspec
.Op Fl L Ar listspec
.Op Fl m Ar meterspec
.Op Fl P Ar poolspec
.Op Fl p Ar paramspec
.Op Fl Q Ar replrqspec
.Op Fl r Ar replstspec
.Op Fl S Ar socket
.Op Fl s Ar showspec
.Op Fl U Ar replrqspec
.Sh DESCRIPTION
The
.Nm
utility controls
.Xr mount_slash 8
behavior.
.Pp
The options are as follows:
.Bl -tag -width Ds
.\" .It Fl c Ar cmd
.\" Instruct
.\" .Xr mount_slash 8
.\" to perform one of the following actions:
.\" .Pp
.\" .Bl -tag -compact -offset indent -width 12n
.\" .It Ic reconfig
.\" .El
.It Fl f Ar cmd
Perform a
.Tn SLASH
file system operation.
.Pp
The following actions are available:
.Bl -tag -offset 3n -width 3n
.It Xo
.Sm off
.Ic new-repl-policy
.Ic = Ar repl-policy
.Ic : Ar fn
.Sm on
.Xc
Set the default replication policy for new bmaps
.Pq file data blocks
for the specified file
.Ar fn .
.Pp
The following replication policies are recognized:
.Bl -tag -width one-time
.It Ic one-time
Replication requests are completed once then removed from the system.
Data replicated will continue to exist at replicas even after new
.Tn I/O
invalidates these copies.
.Pp
See
.Fl r
for checking the replication status of bmaps and retrieving the current
default replication policy of files.
.Pp
This is the default mode.
.It Ic persist
Perpetually propagate any new
.Tn I/O
done to a bmap to other replicas where the bmap is registered for replication.
.El
.It Xo
.Sm off
.Ic bmap-repl-policy= Ar repl-policy
.Ic : Ar bmapspec Ic : Ar fn
.Sm on
.Xc
Set the replication policy for all bmaps specified in
.Ar bmapspec
for the given file
.Ar fn .
.Pp
.Ar bmapspec
has the following format:
.Bd -literal -offset indent
.Sm off
.Ar bmapno-min
.Op Li -\& Ar bmapno-max
.Op Li ,\& Ar ...
.Sm on
.Ed
.Pp
The value
.Li Sq *
will effect all bmaps currently residing in the file.
.Pp
See
.Fl r
for inspecting the replication policy of bmaps.
.El
.It Fl H
Suppress display of headers.
.It Fl h Ar table
Query bucket usage statistics for the given hash table(s).
.Ar table
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm threads
execution threads
.El
.Pp
The value
.Cm all
may be specified to query all hash table statistics.
.It Fl I
Do not use human-readable numbers for large numerical displays,
e.g. show
.Li 1MB
.Pq one megabyte
as
.Li 1048576.
.It Fl i Ar iostatspec
Query I/O statistics.
.Ar iostatspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Ar iostat Ns Op , Ns Ar ...
.Ed
.Pp
.Ar iostat
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It foo
.El
.Pp
The value
.Cm all
may be specified to query all I/O statistics.
.It Fl L Ar listspec
Query list cache information for the given list(s).
.Ar listspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Sm off
.Ar list
.Op , Ar ...
.Sm on
.Ed
.Pp
.Ar list
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm fidcclean
Used FID cache entries.
.It Cm fidcdirty
Dirty FID cache entries.
.It Cm fidcfree
Unused FID cache entries.
.El
.Pp
The value
.Cm all
may be specified to retrieve information about all list caches.
.It Fl m Ar meterspec
Report progress information in meters.
.Ar meterspec
has the following format:
.Bd -unfilled -offset indent
.Ar meter Ns Op , Ns Ar ...
.Ed
.Pp
.Ar meter
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm repl- Ns Ar nid
Replication of inode
.Ar fid
metadata to server
.Ar nid .
.El
.Pp
The value
.Cm all
may be specified to retrieve information about all meters.
.It Fl P Ar poolspec
Report pool parameters.
.Ar poolspec
has the following format:
.Bd -unfilled -offset indent
.Ar pool Ns Op , Ns Ar ...
.Ed
.Pp
The value
.Ic all
may be specified to retrieve information about all pools.
.It Fl p Ar paramspec
Query/manipulate operational control parameters.
.Ar paramspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Sm off
.Oo Ar thread-name Ns . Oc Ar param
.Op = Ar value
.Sm on
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
.Pp
.Ar param
may be one of the following:
.Bl -tag -offset ind -width Ds
.It Ic log.level Ns Op . Ns Ar subsystem
The logging level of debug message output.
.Pp
.Ar subsystem
may be one of the following:
.Pp
.Bl -tag -offset indent -width 12n -compact
.It Ic jrnl
Journaling operations
.It Ic rpc
Remote procedure calls
.It Ic lnet
Lustre networking stack
.It Ic mem
Memory allocations and releases
.It Ic gen
General/catch all
.El
.Pp
If
.Ar subsystem
is left unspecified, all subsystems will be affected.
.Pp
The logging level value may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm none
No logging
.It Cm error
Recoverable failures
.It Cm warn
Something wrong which requires attention
.It Cm notify
Something unusual which recommends attention
.It Cm info
Informational messages
.It Cm debug
Debugging messages
.It Cm trace , all
All messages
.El
.El
.Pp
Fields applicable to all threads (i.e. global parameters) may
be addressed by specifying
.Dq everyone
as the
.Ar thread-name
or by leaving
.Ar thread-name
unspecified altogether.
.Pp
.It Fl Q Ar replrqspec
Perform data replication as specified by
.Ar replrqspec .
The
.Tn I/O
node responsible for the data regions specified will propagate the data
to all other
.Tn I/O
systems specified.
.Pp
.Ar replrqspec
has the following format:
.Bd -unfilled -offset indent
.Sm off
.Ar ios Op Ic ,\& Ar ...
.Ic :\& Ar bmapno-min
.Op Ic -\& Ar bmapno-max
.Op Ic ,\& Ar ...
.Ic :\& Ar filename
.Sm on
.Ed
.Pp
If the special value
.Sq Li *
is supplied as the bmap specification, all present bmaps in the file
will be replicated;
otherwise, only the bmaps with the given indexes will be replicated.
.Pp
By default, bmaps are registered for a single replication after which
they can be invalidated on any replicas they were copied to if new
.Tn I/O
is done.
See
.Fl f
for information on modifying the replication policy.
.Pp
This option may be specified multiple times.
.It Fl R
Apply operations on files specified in
.Fl f ,
.Fl Q ,
.Fl r ,
and
.Fl U
recursively.
.It Fl r Ar file
List the specified
.Ar file Ap s
replication status.
Information about every bmap
.Pq data region
of the file including
.Tn I/O
systems where they have been registered for replication and their status
is displayed.
.Pp
If
.Ar file
is the special name
.Sq \&: ,
all pending replications will be queried.
Note that file names are unavailable in this mode.
.Pp
The following legend lists the states a block may be in:
.Bl -column "schedul" "Replication poli" "Indicator" -offset indent
.It Sy State  Ta Sy Replication Policy Ta Sy Indicator
.It ========================================
.It active    Ta one-time              Ta Ic +
.It scheduled Ta one-time              Ta Ic s
.It old       Ta one-time              Ta Ic o
.Pp
.It active    Ta persistent            Ta Ic *
.It scheduled Ta persistent            Ta Ic S
.It old       Ta persistent            Ta Ic O
.Pp
.It inactive  Ta either                Ta Ic -
.El
.Pp
See
.Fl f
for details on modifying a bmap's replication policy.
.Pp
This option may be specified multiple times.
.It Fl S Ar socket
Specify an alternative socket file.
The following tokens are replaced in the file name specified:
.Pp
.Bl -tag -offset indent -width Ds -compact
.It Ic %h
the machine hostname
.It Ic %%
a literal
.Sq %
character
.El
.Pp
The default is
.Pa /var/run/mount_slash. Ns Ic %h Ns Pa .sock .
.It Fl s Ar showspec
Query and show
.Xr mount_slash 8
parameter values.
.Ar showspec
has the following format:
.Bd -unfilled -offset indent
.Sm off
.Ar param
.Op : Ar thread-name Op , Ar ...
.Sm on
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
.Pp
.Ar param
may be specified as any non-ambiguous prefix abbreviation of the
following:
.Pp
.Bl -tag -offset indent -width 12n -compact
.It Cm loglevels
Query thread logging levels.
.It Cm stats
Query thread activity statistics.
.El
.Pp
This option may be specified multiple times.
.It Fl U Ar replrqspec
Cancel ongoing file replication requests as specified by
.Ar replrqspec .
See
.Fl Q
for details on the format of
.Ar replrqspec .
.Pp
This option may be specified multiple times.
.El
.Ss Thread Specification
Options which take
.Ar thread-name
parameters may be specified by one or more of the following tokens,
separated by commas:
.Pp
.Bl -tag -compact -offset indent -width 15n
.It Cm msbflushthr
Bmap flusher thread
.It Cm msctlthr
Control thread
.It Cm mseqpollthr
Lustre EQPoll thread
.It Cm msfsthr Ns Ar %d
File system service thread
.It Cm msfusethr
.Tn FUSE
master thread
.It Cm msrcmthrthr Ns Ar %02d
.Tn MDS RPC
request service
.It Cm mstintvthr
Timer interval thread
.It Cm mstiosthr
Timed
.Tn I/O
stats updater thread
.It Cm msusklndplthr Ns Ar %d
Lustre userland socket poll thread
.It Cm everyone
All threads (default, where applicable)
.El
.Sh FILES
.Bl -tag -width Pa
.It Xo
.Pa /var/run/mount_slash. Ns Ic %h Ns Pa .sock
.Xc
default
.Xr mount_slash 8
control socket
.El
.Sh SEE ALSO
.Xr sladm 7 ,
.Xr mount_slash 8 ,
.Xr slashd 8
