.\" $Id$
.\" %PSC_START_COPYRIGHT%
.\" -----------------------------------------------------------------------------
.\" Copyright (c) 2008-2010, Pittsburgh Supercomputing Center (PSC).
.\"
.\" Permission to use, copy, and modify this software and its documentation
.\" without fee for personal use or non-commercial use within your organization
.\" is hereby granted, provided that the above copyright notice is preserved in
.\" all copies and that the copyright and this permission notice appear in
.\" supporting documentation.  Permission to redistribute this software to other
.\" organizations or individuals is not permitted without the written permission
.\" of the Pittsburgh Supercomputing Center.  PSC makes no representations about
.\" the suitability of this software for any purpose.  It is provided "as is"
.\" without express or implied warranty.
.\" -----------------------------------------------------------------------------
.\" %PSC_END_COPYRIGHT%
.Dd October 22, 2010
.Dt MSCTL 8
.ds volume PSC \- SLASH Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm msctl
.Nd
.Tn SLASH
file system mount daemon runtime control
.Sh SYNOPSIS
.Nm msctl
.Op Fl HIRv
.\" .Op Fl c Ar cmd
.Op Fl f Ar cmd
.Op Fl h Ar table
.Op Fl i Ar iostatspec
.Op Fl L Ar listspec
.Op Fl m Ar meterspec
.Op Fl P Ar poolspec
.Op Fl p Ar paramspec
.Op Fl Q Ar replrqspec
.Op Fl r Ar replstspec
.Op Fl S Ar socket
.Op Fl s Ar showspec
.Op Fl U Ar replrqspec
.Sh DESCRIPTION
The
.Nm
utility controls
.Xr mount_slash 8
behavior.
.Pp
The options are as follows:
.Bl -tag -width Ds
.\" .It Fl c Ar cmd
.\" Instruct
.\" .Xr mount_slash 8
.\" to perform one of the following actions:
.\" .Pp
.\" .Bl -tag -compact -offset indent -width 12n
.\" .It Cm reconfig
.\" .El
.It Fl f Ar cmd
Perform a
.Tn SLASH
file system operation.
.Pp
The following actions are available:
.Bl -tag -width 3n
.It Xo
.Sm off
.Cm new-repl-policy
.Cm = Ar repl-policy
.Cm : Ar fn
.Sm on
.Xc
Set the default replication policy for new bmaps
.Pq file data blocks
for the specified file
.Ar fn .
.Pp
The following replication policies are recognized:
.Bl -tag -width one-time
.It Cm one-time
Replication requests are completed once then removed from the system.
Data replicated will continue to exist at replicas even after new
.Tn I/O
invalidates these copies.
.Pp
See
.Fl r
for checking the replication status of bmaps and retrieving the current
default replication policy of files.
.Pp
This is the default mode.
.It Cm persist
Perpetually propagate any new
.Tn I/O
done to a bmap to other replicas where the bmap is registered for replication.
.El
.It Xo
.Sm off
.Cm bmap-repl-policy= Ar repl-policy
.Cm : Ar bmapspec Cm : Ar fn
.Sm on
.Xc
Set the replication policy for all bmaps specified in
.Ar bmapspec
for the given file
.Ar fn .
.Pp
.Ar bmapspec
has the following format:
.Bd -literal -offset indent
.Sm off
.Ar bmapno-min
.Op Li -\& Ar bmapno-max
.Op Li ,\& Ar ...
.Sm on
.Ed
.Pp
The value
.Sq Li *
will effect all bmaps currently residing in the file.
.Pp
See
.Fl r
for inspecting the replication policy of bmaps.
.El
.It Fl H
Suppress display of headers.
.It Fl h Ar table
Query bucket usage statistics for the given hash table(s).
.Ar table
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm fidc
files
.Po file
.Tn ID
cache
.Pc
.It Cm resnid
network resources
.Pq network Tn ID
.El
.Pp
The value
.Cm all
may be specified to query all hash table statistics.
.It Fl I
Do not use human-readable numbers for large numerical displays,
e.g. show
.Li 1MB
.Pq one megabyte
as
.Li 1048576.
.It Fl i Ar iostatspec
Query I/O statistics.
.Ar iostatspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Ar iostat Ns Op , Ns Ar ...
.Ed
.Pp
.Ar iostat
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm lni-rcv- Ns Ar if ,
.It Cm lni-snd- Ns Ar if
Data sent/received per
.Tn LNET
networking interface.
.Pp
.It Cm lusklnd- Ns Ar mode Ns Cm -rcv ,
.It Cm lusklnd- Ns Ar mode Ns Cm -snd
Data sent/received over userland socket networking device.
.Ar mode
may be
.Cm pasv
.Pq passive
or
.Cm aggr
.Pq aggregate .
.El
.Pp
The value
.Cm all
may be specified to query all
.Tn I/O
statistics.
.It Fl L Ar listspec
Query list cache information for the given list(s).
.Ar listspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Sm off
.Ar list
.Op , Ar ...
.Sm on
.Ed
.Pp
.Ar list
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm bmapflush
Bmaps awaiting flush completion
.It Cm bmaptimeout
Expired bmaps awaiting release
.It Cm bmpcLru
Reapable bmap structures
.It Cm dircache
Directory entries
.It Cm fcmhidle
Clean
.Pq reapable
files
.It Cm fcmhbusy
File with pending action e.g.\&
.Tn I/O
.El
.Pp
The value
.Cm all
may be specified to retrieve information about all list caches.
.It Fl m Ar meterspec
Report progress information in meters.
.Ar meterspec
has the following format:
.Bd -unfilled -offset indent
.Ar meter Ns Op , Ns Ar ...
.Ed
.Pp
.Ar meter
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm repl- Ns Ar nid
Replication of inode
.Ar fid
metadata to server
.Ar nid .
.El
.Pp
The value
.Cm all
may be specified to retrieve information about all meters.
.It Fl P Ar poolspec
Report pool parameters.
.Ar poolspec
has the following format:
.Bd -unfilled -offset indent
.Ar pool Ns Op , Ns Ar ...
.Ed
.Pp
The value
.Cm all
may be specified to retrieve information about all pools.
.It Fl p Ar paramspec
Query/manipulate operational control parameters.
.Ar paramspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Sm off
.Oo Ar thread-name Ns . Oc Ar param
.Op = Ar value
.Sm on
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
.Pp
.Ar param
may be one of the following:
.Bl -tag -offset ind -width Ds
.It Cm log.level Ns Op . Ns Ar subsystem
The logging level of debug message output.
.Pp
.Ar subsystem
may be one of the following:
.Pp
.Bl -tag -offset indent -width 12n -compact
.It Cm bmap
Block map structures
.It Cm gen
General/catch all
.It Cm lnet
Lustre networking stack
.It Cm mem
Memory allocations and releases
.It Cm rpc
Network remote procedure calls
.El
.Pp
If
.Ar subsystem
is left unspecified, all subsystems will be affected.
.Pp
The logging level value may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm none
No logging
.It Cm error
Recoverable failures
.It Cm warn
Something wrong which requires attention
.It Cm notify
Something unusual which recommends attention
.It Cm info
Informational messages
.It Cm debug
Debugging messages
.It Cm trace , all
All messages
.El
.It Cm pool. Ns Ar name
Access the memory pool specified by
.Ar name .
The following sub-fields are available:
.Pp
.Bl -tag -compact -offset 2n -width 5n
.It Cm min
Lower bound for number of entries to which pool can shrink.
.It Cm max
Upper bound for number of entries to which pool can grow.
.It Cm size
Current number of entries contained in pool.
.El
.El
.Pp
Fields applicable to all threads (i.e. global parameters) may
be addressed by specifying
.Dq everyone
as the
.Ar thread-name
or by leaving
.Ar thread-name
unspecified altogether.
.Pp
.It Fl Q Ar replrqspec
Perform data replication as specified by
.Ar replrqspec .
The
.Tn I/O
node responsible for the data regions specified will propagate the data
to all other
.Tn I/O
systems specified.
.Pp
.Ar replrqspec
has the following format:
.Bd -unfilled -offset indent
.Sm off
.Ar ios Op Cm ,\& Ar ...
.Cm :\& Ar bmapno-min
.Op Cm -\& Ar bmapno-max
.Op Cm ,\& Ar ...
.Cm :\& Ar filename
.Sm on
.Ed
.Pp
If the special value
.Sq Li *
is supplied as the bmap specification, all present bmaps in the file
will be replicated;
otherwise, only the bmaps with the given indexes will be replicated.
.Pp
By default, bmaps are registered for a single replication after which
they can be invalidated on any replicas they were copied to if new
.Tn I/O
is done.
See
.Fl f
for information on modifying the replication policy.
.Pp
This option may be specified multiple times.
.It Fl R
Apply operations on files specified in
.Fl f ,
.Fl Q ,
.Fl r ,
and
.Fl U
recursively.
.It Fl r Ar file
List the specified
.Ar file Ap s
replication status.
Information about every bmap
.Pq data region
of the file including
.Tn I/O
systems where they have been registered for replication and their status
is displayed.
.Pp
If
.Ar file
is the special value
.Sq \&: ,
all pending replications will be queried.
Note that file names are unavailable in this mode.
.Pp
The following legend lists the states a block map may be in for the
one-time or persistent replication policies:
.Bl -column "reclaimi" "one-ti" "Indicator" -offset indent
.It Sy State   Ta Sy One-time Ta Sy Persistent
.It ================================
.It active     Ta Li + Ta Li *
.It reclaiming Ta Li x Ta Li X
.It garbage    Ta Li g Ta Li G
.It inactive   Ta Li - Ta Li /
.It old        Ta Li q Ta Li Q
.It scheduled  Ta Li s Ta Li S
.It truncated  Ta Li t Ta Li T
.El
.Pp
See
.Fl f
for details on modifying a bmap's replication policy.
.Pp
This option may be specified multiple times.
.It Fl S Ar socket
Specify an alternative socket file.
The following tokens are replaced in the file name specified:
.Pp
.Bl -tag -offset indent -width Ds -compact
.It Cm %h
the machine hostname
.It Cm %%
a literal
.Sq %
character
.El
.Pp
The default is
.Pa /var/run/mount_slash. Ns Ic %h Ns Pa .sock .
.It Fl s Ar showspec
Query and show
.Xr mount_slash 8
parameter values.
.Ar showspec
has the following format:
.Bd -unfilled -offset indent
.Sm off
.Ar param
.Op : Ar thread-name Op , Ar ...
.Sm on
.Ed
.Pp
.Ar param
may be specified as any non-ambiguous prefix abbreviation of the
following:
.Pp
.Bl -tag -offset indent -width 12n -compact
.It Cm connections
Status of hosts on network.
.It Cm files
Files in cache.
.It Cm loglevels
Query thread logging levels.
.It Cm stats
Query thread activity statistics.
.El
.Pp
The special value
.Sq \&?
may be specified to display a list of recognized values.
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
.Pp
This option may be specified multiple times.
.It Fl U Ar replrqspec
Cancel ongoing file replication requests as specified by
.Ar replrqspec .
See
.Fl Q
for details on the format of
.Ar replrqspec .
.Pp
This option may be specified multiple times.
.It Fl v
Verbose mode:
display additional information about each operation being performed.
.El
.Ss Thread Specification
Options which take
.Ar thread-name
parameters may be specified by one or more of the following tokens,
separated by commas:
.Pp
.Bl -tag -compact -offset indent -width 15n
.It Cm msbflushthr Ns Ar %d
Bmap flusher thread
.It Cm msbflushrpcthr
Bmap flusher asynchronous
.Tn RPC
reply thread
.It Cm msbrlsthr
Bmap timed releaser thread
.It Cm msconnthr- Ns Ar %s
Remote server connection monitor
.It Cm msctlacthr
.Xr mount_slash 8
connection acceptor
.It Cm msctlthr
.Xr mount_slash 8
connection processor
.It Cm mseqpollthr
Lustre
.Fn LNetEQPoll
thread
.It Cm msfsmgrthr
Userland file system manager thread
.Pq e.g. FUSE
.It Cm msfsthr Ns Ar %d
File system system caller service thread
.It Cm msrcmthr Ns Ar %02d
.Tn MDS RPC
request service
.It Cm mstiosthr
Timed
.Tn I/O
stats updater thread
.It Cm msusklndplthr Ns Ar %d
Lustre userland socket poll thread
.It Cm everyone
All threads (default, where applicable)
.El
.Sh FILES
.Bl -tag -width Pa
.It Xo
.Pa /var/run/mount_slash. Ns Ic %h Ns Pa .sock
.Xc
default
.Xr mount_slash 8
control socket
.El
.Sh SEE ALSO
.Xr sladm 7 ,
.Xr mount_slash 8 ,
.Xr slashd 8
