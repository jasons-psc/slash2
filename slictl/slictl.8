.\" $Id$
.\" %PSC_START_COPYRIGHT%
.\" -----------------------------------------------------------------------------
.\" Copyright (c) 2008-2011, Pittsburgh Supercomputing Center (PSC).
.\"
.\" Permission to use, copy, and modify this software and its documentation
.\" without fee for personal use or non-commercial use within your organization
.\" is hereby granted, provided that the above copyright notice is preserved in
.\" all copies and that the copyright and this permission notice appear in
.\" supporting documentation.  Permission to redistribute this software to other
.\" organizations or individuals is not permitted without the written permission
.\" of the Pittsburgh Supercomputing Center.  PSC makes no representations about
.\" the suitability of this software for any purpose.  It is provided "as is"
.\" without express or implied warranty.
.\" -----------------------------------------------------------------------------
.\" %PSC_END_COPYRIGHT%
.\" %PFL_MODULES rpc %
.Dd May 10, 2011
.Dt SLICTL 8
.ds volume PSC \- SLASH Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm slictl
.Nd
.Tn SLASH
.Xr sliod 8
runtime control
.Sh SYNOPSIS
.Nm slictl
.Op Fl HIn
.Op Fl p Ar paramspec
.Op Fl S Ar socket
.Op Fl s Ar showspec
.Op Ar cmd arg ...
.Sh DESCRIPTION
The
.Nm
utility examines and manipulates
.Xr sliod 8
behavior.
.Pp
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/cmd.mdoc {
.\"	cmds => {
.\"		stop => <<'EOF'
.\"			Instruct
.\"			.Xr sliod 8
.\"			to completely terminate daemon execution.
.\"			EOF
.\"	}
The supported commands are as follows:
.Bl -tag -width 3n
.It Cm stop
Instruct
.Xr sliod 8
to completely terminate daemon execution.
.El
.\" }%
.Pp
The options are as follows:
.Bl -tag -width 3n
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/H.mdoc {
.It Fl H
Suppress headers when showing data displays.
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/I.mdoc {
.It Fl I
Display large numerical values accurately instead of rounded with
postfixes of demonination such as
.Sq G
for gigabytes,
.Sq M
for megabytes, etc.\&
.Pq Do inhuman Dc number mode .
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/n.mdoc {
.It Fl n
Suppress
.Tn DNS
lookups for network addresses.
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/p.mdoc {
.\"	subsys => {
.\"		bmap		=> "Block map structures",
.\"		fcmh		=> ".Tn FID\ncache members",
.\"		slvr		=> "Sliver\n.Pq Tn I/O No slab\nhandling"
.\"	}
.It Fl p Ar paramspec
Query/manipulate operational parameters.
.Ar paramspec
has the following format:
.Pp
.Bd -unfilled -offset 3n
.Sm off
.Oo Ar thread-name Ns Li .\& Oc Ar param
.Op Oo Li +- Oc Li = Ar value
.Sm on
.Ed
.Pp
Some parameters may be read- or write-only.
Some support modification by the assignment operators
.Li +=
and
.Li -= .
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
The default behavior is to apply the operation to all applicable threads.
.Pp
.Ar param
may be one of the following:
.Bl -tag -width 1n -offset 3n
.It Cm lnet.networks
.Tn LNET
network configuration.
.It Cm lnet.port
If applicable,
.Xr tcp 7
port to use to connect to remote
.Tn LNET
peers.
.It Cm log.file
File path name where log messages will be written.
This value is write-only.
If the
.Li +=
assignment operator is used, this file will not be truncated.
.It Cm log.format
The header prepended to server log messages.
See
.Xr pflenv 7
for details on this format.
.It Cm log.level Ns Op . Ns Ar subsystem
The logging level of debug message output.
.Pp
.Ar subsystem
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm bmap
Block map structures
.It Cm def
Default
.It Cm fcmh
.Tn FID
cache members
.It Cm lnet
Lustre networking stack
.It Cm mem
Memory allocations and releases
.It Cm rpc
Network remote procedure calls
.It Cm slvr
Sliver
.Pq Tn I/O No slab
handling
.El
.Pp
If
.Ar subsystem
is left unspecified, all subsystems will be accessed.
.Pp
The log level value may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm 0 , none
No logging
.It Cm 1 , error
Recoverable failures
.It Cm 2 , warn
Something wrong which requires attention
.Pq default
.It Cm 3 , notice
Something unusual which recommends attention
.It Cm 4 , info
Informational messages
.It Cm 5 , debug
Debugging messages
.It Cm 6 , trace , all
All messages
.El
.It Cm pool. Ns Ar name
Access the memory pool specified by
.Ar name .
The following sub-fields are available:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm max
Upper bound for number of entries to which auto-sized pools can grow.
.It Cm min
Lower bound for number of entries to which auto-sized pools can shrink.
.It Cm thres
Threshold for unused items for auto-sized pools before items are freed.
.It Cm total
Current number of entries contained in pool.
.El
.It Cm rlim
Process resource limits.
See
.Xr getrlimit 2
or
.Xr ulimit 1
for more information.
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm nofiles
Corresponds to
.Dv RLIMIT_NOFILE ,
the maximum number of open files.
.El
.El
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/S.mdoc {
.\"	daemon	=> qq{sliod},
.\"	sock	=> "/var/run/sliod. Ns Ic %h Ns Pa .sock"
.It Fl S Ar socket
Specify an alternative socket file.
The following tokens are replaced in the file name specified:
.Pp
.Bl -tag -offset 3n -width Ds -compact
.It Cm %h
the machine hostname
.It Cm %n
the daemon executable base name, i.e.\&
.Dq sliod
.It Cm %%
a literal
.Sq %
character
.El
.Pp
The default is
.Pa /var/run/sliod. Ns Ic %h Ns Pa .sock .
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/show.mdoc {
.\"	show => {
.\"		connections	=> "Status of\n.Tn SLASH\npeers on network",
.\"		fidcache	=> ".Tn FID\n.Pq file- Ns Tn ID\ncache members",
.\"		replwkst	=> "Status of active replications"
.\"	},
.\"	pools => {
.\"		bmap		=> "Block map structures"
.\"	},
.\"	listcaches => {
.\"		bmapReapQ	=> "Bmaps to be processed by reaper",
.\"		bmapRlsQ	=> "Bmaps awaiting release by\n.Tn MDS\nresponse",
.\"		bmpcLru		=> "Reapable bmap structures",
.\"		crcqSlvrs	=> "Bmap slivers awaiting checksum",
.\"		fcmhbusy	=> "Files with pending activity e.g.\\&\n.Tn I/O",
.\"		fcmhidle	=> "Clean\n.Pq reapable\nfiles",
.\"		lruSlvrs	=> "Reapable bmap slivers",
.\"		replwkpnd	=> "Pending replication work"
.\"	},
.\"	hashtables => {
.\"		fidc		=> "files\n.Po file\n.Tn ID\ncache\n.Pc",
.\"		resnid		=> "network resources\n.Pq network Tn ID"
.\"	}
.It Fl s Ar showspec
Show values.
.Ar showspec
has the following format:
.Bd -unfilled -offset 3n
.Sm off
.Ar param
.Op : Ar subspec
.Sm on
.Ed
.Pp
.Ar param
may be specified as any non-ambiguous prefix abbreviation of the
following:
.Pp
.Bl -tag -width 1n -offset 3n
.It Cm connections
Status of
.Tn SLASH
peers on network
.It Cm fidcache
.Tn FID
.Pq file- Ns Tn ID
cache members
.It Cm hashtables
Hash table statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset 3n
.Ar hash-table Ns Op , Ns Ar ...
.Ed
.Pp
.Ar hash-table
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm fidc
files
.Po file
.Tn ID
cache
.Pc
.It Cm resnid
network resources
.Pq network Tn ID
.El
.Pp
If
.Ar subspec
is left unspecified, all hash tables will be accessed.
.It Cm iostats
.Tn I/O
statistics.
.Ar subspec
has the following format:
.Pp
.Bd -unfilled -offset 3n
.Ar iostats Ns Op , Ns Ar ...
.Ed
.Pp
.Ar iostats
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 3n
.It Cm lni-rcv- Ns Ar if ,
.It Cm lni-snd- Ns Ar if
Data sent/received per
.Tn LNET
networking interface.
.Pp
.It Cm lusklnd- Ns Ar mode Ns Cm -rcv ,
.It Cm lusklnd- Ns Ar mode Ns Cm -snd
Data sent/received over userland socket networking device.
.Ar mode
may be
.Cm pasv
.Pq passive
or
.Cm aggr
.Pq aggregate .
.Pp
.It Cm rpc- Ns Ar addr Ns Cm -rcv ,
.It Cm rpc- Ns Ar addr Ns Cm -snd
Data sent/received per
.Tn RPC
peer.
.Pp
.El
.Pp
If
.Ar subspec
is left unspecified, all
.Tn I/O
statistics will be accessed.
.It Cm listcaches
List cache statistics.
.Ar subspec
has the following format:
.Pp
.Bd -unfilled -offset 3n
.Ar list Ns Op , Ns Ar ...
.Ed
.Pp
.Ar list
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm bmapReapQ
Bmaps to be processed by reaper
.It Cm bmapRlsQ
Bmaps awaiting release by
.Tn MDS
response
.It Cm bmpcLru
Reapable bmap structures
.It Cm crcqSlvrs
Bmap slivers awaiting checksum
.It Cm fcmhbusy
Files with pending activity e.g.\&
.Tn I/O
.It Cm fcmhidle
Clean
.Pq reapable
files
.It Cm lruSlvrs
Reapable bmap slivers
.It Cm replwkpnd
Pending replication work
.El
.Pp
If
.Ar subspec
is left unspecified, all list caches will be accessed.
.It Cm loglevels
Thread logging levels.
.Ar subspec
has the following format:
.Bd -unfilled -offset 3n
.Ar thread Ns Op , Ns Ar ...
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread .
If
.Ar subspec
is left unspecified, all threads will be accessed.
.It Cm pools
Memory pool statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset 3n
.Ar pool Ns Op , Ns Ar ...
.Ed
.Pp
.Ar pool
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm bmap
Block map structures
.El
.Pp
If
.Ar subspec
is left unspecified, all pools will be accessed.
.It Cm replwkst
Status of active replications
.It Cm rpcsvcs
.Tn RPC
services.
.It Cm threads
Daemon thread activity and statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset 3n
.Ar thread Ns Op , Ns Ar ...
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread .
If
.Ar subspec
is left unspecified, all threads will be accessed.
.El
.Pp
The special value
.Sq \&?
may also be specified to display a list of recognized values.
.\" }%
.El
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/thr.mdoc {
.\"	thrs => {
.\"		"slibmaprlsthr"			=> "Bmap releaser",
.\"		"sliconnthr- Ns Ar %s"		=> "Remote server connection monitor",
.\"		"slictlacthr"			=> ".Nm\nconnection acceptor",
.\"		"slictlthr"			=> ".Nm\nconnection processor",
.\"		"slilnacthr- Ns Ar %s"		=> "Lustre network acceptor thread",
.\"		"slireplpndthr"			=> "Pending replication work processor",
.\"		"slireplreapthr"		=> "Finished replication work reaper",
.\"		"sliricthr Ns Ar %02d"		=> "Client\n.Tn RPC\nrequest service thread",
.\"		"sliriithr Ns Ar %02d"		=> ".No Inter- Ns Tn I/O RPC\nrequest service thread",
.\"		"slirimthr Ns Ar %02d"		=> ".Tn MDS RPC\nrequest service thread",
.\"		"slislvrthr Ns Ar %d"		=> "Sliver monitoring thread",
.\"		"slistatfsthr"			=> "Periodic\n.Xr statvfs 2\nupdater",
.\"		"slitiosthr"			=> "Timed\n.Tn I/O\nstats updater thread",
.\"		"sliusklndplthr Ns Ar %d"	=> "Lustre userland socket poll thread"
.\"	}
.Ss Thread Specification
Options which take
.Ar thread-name
parameters may be specified by one or more of the following tokens,
separated by commas:
.Pp
.Bl -tag -compact -offset 3n -width 16n
.It Cm slibmaprlsthr
Bmap releaser
.It Cm sliconnthr- Ns Ar %s
Remote server connection monitor
.It Cm slictlacthr
.Nm
connection acceptor
.It Cm slictlthr
.Nm
connection processor
.It Cm slilnacthr- Ns Ar %s
Lustre network acceptor thread
.It Cm slireplpndthr
Pending replication work processor
.It Cm slireplreapthr
Finished replication work reaper
.It Cm sliricthr Ns Ar %02d
Client
.Tn RPC
request service thread
.It Cm sliriithr Ns Ar %02d
.No Inter- Ns Tn I/O RPC
request service thread
.It Cm slirimthr Ns Ar %02d
.Tn MDS RPC
request service thread
.It Cm slislvrthr Ns Ar %d
Sliver monitoring thread
.It Cm slistatfsthr
Periodic
.Xr statvfs 2
updater
.It Cm slitiosthr
Timed
.Tn I/O
stats updater thread
.It Cm sliusklndplthr Ns Ar %d
Lustre userland socket poll thread
.It Cm everyone
All threads
.Pq default, where applicable
.El
.\" }%
.El
.Sh FILES
.Bl -tag -width Pa
.It Pa /var/run/sliod. Ns Ic %h Ns Pa .sock
default
.Xr sliod 8
control socket
.El
.Sh SEE ALSO
.Xr sladm 7 ,
.Xr sliod 8
