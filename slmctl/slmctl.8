.\" $Id$
.\" %PSC_START_COPYRIGHT%
.\" -----------------------------------------------------------------------------
.\" Copyright (c) 2008-2011, Pittsburgh Supercomputing Center (PSC).
.\"
.\" Permission to use, copy, and modify this software and its documentation
.\" without fee for personal use or non-commercial use within your organization
.\" is hereby granted, provided that the above copyright notice is preserved in
.\" all copies and that the copyright and this permission notice appear in
.\" supporting documentation.  Permission to redistribute this software to other
.\" organizations or individuals is not permitted without the written permission
.\" of the Pittsburgh Supercomputing Center.  PSC makes no representations about
.\" the suitability of this software for any purpose.  It is provided "as is"
.\" without express or implied warranty.
.\" -----------------------------------------------------------------------------
.\" %PSC_END_COPYRIGHT%
.\" %PFL_MODULES rpc %
.Dd January 24, 2011
.Dt SLMCTL 8
.ds volume PSC \- SLASH Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm slmctl
.Nd
.Tn SLASH MDS
daemon runtime control
.Sh SYNOPSIS
.Nm slmctl
.Op Fl HI
.Op Fl c Ar cmd
.Op Fl p Ar paramspec
.Op Fl S Ar socket
.Op Fl s Ar showspec
.Sh DESCRIPTION
The
.Nm
utility examines and manipulates
.Xr slashd 8
behavior.
.Pp
The options are as follows:
.Bl -tag -width Ds
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/c.mdoc {
.\"	daemon	=> qq{slashd},
.\"	cmds	=> {
.\" #		reconfig => "Reload configuration"
.\"	}
.It Fl c Ar cmd
Instruct
.Xr slashd 8
to perform one of the following actions:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm exit
Completely terminate daemon execution.
.El
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/H.mdoc {
.It Fl H
Suppress display of headers.
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/I.mdoc {
.It Fl I
Display large numerical values accurately instead of rounded with
postfixes of demonination such as
.Sq G
for gigabytes,
.Sq M
for megabytes, etc.\&
.Pq inhuman mode .
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/p.mdoc {
.\"	subsys => {
.\"		bmap		=> "Block map structures",
.\"		fcmh		=> ".Tn FID\ncache members",
.\"		jrnl		=> "Journaling operations"
.\"	}
.It Fl p Ar paramspec
Query/manipulate operational parameters.
.Ar paramspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Sm off
.Oo Ar thread-name Ns Li .\& Oc Ar param
.Op Oo Li +- Oc Li = Ar value
.Sm on
.Ed
.Pp
Some parameters are read-only.
Some support modification by the assignment operators
.Li +=
and
.Li -= .
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread-name .
The default behavior is to apply the operation to all applicable threads.
.Pp
.Ar param
may be one of the following:
.Bl -tag -width 3n -offset 3n
.It Cm lnet.networks
.Tn LNET
network configuration.
.It Cm lnet.port
If applicable,
.Xr tcp 7
port to use to connect to remote
.Tn LNET
peers.
.It Cm lnet.sdp
Whether
.Tn LNET
is using the sockets direct protocol.
.It Cm log.file
File path name where log messages will be written.
This value is write-only.
If the
.Li +=
assignment operator is used, this file will not be truncated.
.It Cm log.format
The header prepended to server log messages.
See
.Xr pflenv 7
for details on this format.
.It Cm log.level Ns Op . Ns Ar subsystem
The logging level of debug message output.
.Pp
.Ar subsystem
may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm bmap
Block map structures
.It Cm def
Default
.It Cm fcmh
.Tn FID
cache members
.It Cm jrnl
Journaling operations
.It Cm lnet
Lustre networking stack
.It Cm mem
Memory allocations and releases
.It Cm rpc
Network remote procedure calls
.El
.Pp
If
.Ar subsystem
is left unspecified, all subsystems will be accessed.
.Pp
The log level value may be one of the following:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm 0 , none
No logging
.It Cm 1 , error
Recoverable failures
.It Cm 2 , warn
Something wrong which requires attention
.Pq default
.It Cm 3 , notice
Something unusual which recommends attention
.It Cm 4 , info
Informational messages
.It Cm 5 , debug
Debugging messages
.It Cm 6 , trace , all
All messages
.El
.It Cm pool. Ns Ar name
Access the memory pool specified by
.Ar name .
The following sub-fields are available:
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm max
Upper bound for number of entries to which auto-sized pools can grow.
.It Cm min
Lower bound for number of entries to which auto-sized pools can shrink.
.It Cm thres
Threshold for unused items for auto-sized pools before items are freed.
.It Cm total
Current number of entries contained in pool.
.El
.It Cm rlim
Process resource limits.
See
.Xr getrlimit 2
or
.Xr ulimit 1
for more information.
.Pp
.Bl -tag -compact -offset 3n -width 13n
.It Cm nofiles
Corresponds to
.Dv RLIMIT_NOFILE ,
the maximum number of open files.
.El
.El
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/S.mdoc {
.\"	sock => "/var/run/slashd. Ns Ic %h Ns Pa .sock"
.It Fl S Ar socket
Specify an alternative socket file.
The following tokens are replaced in the file name specified:
.Pp
.Bl -tag -offset indent -width Ds -compact
.It Cm %h
the machine hostname
.It Cm %n
the daemon executable base name, i.e.\&
.Li slashd
.It Cm %%
a literal
.Sq %
character
.El
.Pp
The default is
.Pa /var/run/slashd. Ns Ic %h Ns Pa .sock .
.\" }%
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/show.mdoc {
.\"	show => {
.\"		connections	=> qq{Status of\n.Tn SLASH\npeers on network},
.\"		fidcache	=> qq{.Tn FID\n.Pq file- Ns Tn ID\ncache members},
.\"		odtables	=> qq{Disk-backed data files.}
.\"	},
.\"	hashtables => {
.\"		fidc		=> qq{files\n.Po file\n.Tn ID\ncache\n.Pc},
.\"		resnid		=> qq{network resources\n.Pq network Tn ID}
.\"	},
.\"	iostats => {
.\"		qq{jrnlrd- Ns Ar fn ,} => "",
.\"		qq{jrnlwr- Ns Ar fn} =>
.\"		    qq{Data read/written to journal disk file\n.Ar fn .\n.Pp}
.\"	},
.\"	listcaches => {
.\"		fcmhbusy	=> "File with pending action e.g.\\&\n.Tn I/O",
.\"		fcmhidle	=> "Clean\n.Pq reapable\nfiles",
.\"		inflightbml	=> "Active bmap lease mode updates",
.\"		pendingbml	=> "Pending bmap lease mode updates",
.\"		replstwkq	=> "Replication status work buffers"
.\"	},
.\"	pools => {
.\"		bmap		=> qq{Block map structures}
.\"	}
.It Fl s Ar showspec
Show values.
.Ar showspec
has the following format:
.Bd -unfilled -offset indent
.Sm off
.Ar param
.Op : Ar subspec
.Sm on
.Ed
.Pp
.Ar param
may be specified as any non-ambiguous prefix abbreviation of the
following:
.Pp
.Bl -tag -width 3n -offset 3n
.It Cm connections
Status of
.Tn SLASH
peers on network
.It Cm fidcache
.Tn FID
.Pq file- Ns Tn ID
cache members
.It Cm hashtables
Hash table statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset indent
.Ar hash-table Ns Op , Ns Ar ...
.Ed
.Pp
.Ar hash-table
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm fidc
files
.Po file
.Tn ID
cache
.Pc
.It Cm resnid
network resources
.Pq network Tn ID
.El
.Pp
If
.Ar subspec
is left unspecified, all hash tables will be accessed.
.It Cm iostats
.Tn I/O
statistics.
.Ar iostatspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Ar iostats Ns Op , Ns Ar ...
.Ed
.Pp
.Ar iostats
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width Ds
.It Cm jrnlrd- Ns Ar fn ,
.It Cm jrnlwr- Ns Ar fn
Data read/written to journal disk file
.Ar fn .
.Pp
.It Cm lni-rcv- Ns Ar if ,
.It Cm lni-snd- Ns Ar if
Data sent/received per
.Tn LNET
networking interface.
.Pp
.It Cm lusklnd- Ns Ar mode Ns Cm -rcv ,
.It Cm lusklnd- Ns Ar mode Ns Cm -snd
Data sent/received over userland socket networking device.
.Ar mode
may be
.Cm pasv
.Pq passive
or
.Cm aggr
.Pq aggregate .
.Pp
.El
.Pp
If
.Ar subspec
is left unspecified, all
.Tn I/O
statistics will be accessed.
.It Cm listcaches
List cache statistics.
.Ar subspec
has the following format:
.Pp
.Bd -unfilled -offset indent
.Ar list Ns Op , Ns Ar ...
.Ed
.Pp
.Ar list
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 18n
.It Cm fcmhbusy
File with pending action e.g.\&
.Tn I/O
.It Cm fcmhidle
Clean
.Pq reapable
files
.It Cm inflightbml
Active bmap lease mode updates
.It Cm pendingbml
Pending bmap lease mode updates
.It Cm replstwkq
Replication status work buffers
.El
.Pp
If
.Ar subspec
is left unspecified, all list caches will be accessed.
.It Cm loglevels
Thread logging levels.
.Ar subspec
has the following format:
.Bd -unfilled -offset indent
.Ar thread Ns Op , Ns Ar ...
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread .
If
.Ar subspec
is left unspecified, all threads will be accessed.
.It Cm odtables
Disk-backed data files.
.It Cm pools
Memory pool statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset indent
.Ar pool Ns Op , Ns Ar ...
.Ed
.Pp
.Ar pool
may be one of the following:
.Pp
.Bl -tag -compact -offset indent -width 12n
.It Cm bmap
Block map structures
.El
.Pp
If
.Ar subspec
is left unspecified, all pools will be accessed.
.It Cm rpcsvcs
.Tn RPC
services.
.It Cm threads
Daemon thread activity and statistics.
.Ar subspec
has the following format:
.Bd -unfilled -offset indent
.Ar thread Ns Op , Ns Ar ...
.Ed
.Pp
See
.Sx Thread Specification
for details on specifying
.Ar thread .
If
.Ar subspec
is left unspecified, all threads will be accessed.
.El
.Pp
The special value
.Sq \&?
may also be specified to display a list of recognized values.
.\" }%
.El
.\" %PFL_INCLUDE $PFL_BASE/doc/pflctl/thr.mdoc {
.\"	thrs => {
.\"		"slmbmaptimeothr"		=> "Bmap lease timeout monitor",
.\"		"slmcohthr"			=> "Bmap data coherency thread",
.\"		"slmctlacthr"			=> ".Nm\nconnection acceptor",
.\"		"slmctlthr"			=> ".Nm\nconnection processor",
.\"		"slmjcursorthr"			=> "Journal cursor updater thread",
.\"		"slmjthr"			=> "Master journal thread",
.\"		"slmlnacthr- Ns Ar %s"		=> ".Tn LNET\nnetwork acceptor thread",
.\"		"slmrcmthr"			=> "Client\n.Tn RPC\nrequest initiator thread",
.\"		"slmrmcthr Ns Ar %02d"		=> "Client\n.Tn RPC\nrequest service thread",
.\"		"slmrmithr Ns Ar %02d"		=> ".Tn I/O\nnode\n.Tn RPC\nrequest service thread",
.\"		"slmrmmthr Ns Ar %02d"		=> ".No Inter- Ns Tn MDS RPC\nrequest service thread",
.\"		"slmtiosthr"			=> "Timed\n.Tn I/O\nstats updater thread",
.\"		"slmupschedthr- Ns Ar %s"	=> "Per-site update scheduler thread",
.\"		"slmusklndplthr Ns Ar %d"	=> ".Tn LNET\nuserland socket poll thread"
.\"	}
.Ss Thread Specification
Options which take
.Ar thread-name
parameters may be specified by one or more of the following tokens,
separated by commas:
.Pp
.Bl -tag -compact -offset indent -width 16n
.It Cm slmbmaptimeothr
Bmap lease timeout monitor
.It Cm slmcohthr
Bmap data coherency thread
.It Cm slmctlacthr
.Nm
connection acceptor
.It Cm slmctlthr
.Nm
connection processor
.It Cm slmjcursorthr
Journal cursor updater thread
.It Cm slmjthr
Master journal thread
.It Cm slmlnacthr- Ns Ar %s
.Tn LNET
network acceptor thread
.It Cm slmrcmthr
Client
.Tn RPC
request initiator thread
.It Cm slmrmcthr Ns Ar %02d
Client
.Tn RPC
request service thread
.It Cm slmrmithr Ns Ar %02d
.Tn I/O
node
.Tn RPC
request service thread
.It Cm slmrmmthr Ns Ar %02d
.No Inter- Ns Tn MDS RPC
request service thread
.It Cm slmtiosthr
Timed
.Tn I/O
stats updater thread
.It Cm slmupschedthr- Ns Ar %s
Per-site update scheduler thread
.It Cm slmusklndplthr Ns Ar %d
.Tn LNET
userland socket poll thread
.It Cm everyone
All threads
.Pq default, where applicable
.El
.\" }%
.Sh FILES
.Bl -tag -width Pa
.It Xo
.Pa /var/run/slashd. Ns Ic %h Ns Pa .sock
.Xc
default
.Xr slashd 8
control socket
.El
.Sh SEE ALSO
.Xr sladm 7 ,
.Xr slashd 8 ,
.Xr slictl 8
