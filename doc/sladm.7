.\" $Id$
.Dd September 4, 2009
.Dt SLADM 7
.ds volume PSC - Slash Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm sladm
.Nd Slash administration guide
.Sh DESCRIPTION
Slash is a distributed network file system featuring:
.Pp
.Bl -bullet -compact -offset indent
.It
replication
.El
.Ss Creating a Slash File System
Slash uses
.Tn ZFS
for its backend metadata file system.
To create a new
.Tn ZFS
file system, launch the
.Xr zfs-fuse 8
daemon:
.Bd -literal -offset indent
# zfs-fuse
.Pp
.Ed
Next, create a
.Tn ZFS
pool with
.Xr zpool 8
which will be the master
.Tn ZFS
resource for use by the Slash file system:
.Bd -literal -offset indent
# ./zpool create mypool mirror sda sdb
.Ed
.Pp
To import the settings of this file system into Slash, a zpool cache
file is needed, which can also be created with
.Xr zpool :
.Bd -literal -offset indent
# ./zpool set cachefile=mypool.cf mypool
.Ed
.Pp
Now that the pool has been setup, the
.Xr zfs-fuse 8
daemon should be terminated so Slash be the single accessor of the new
file system:
.Bd -literal -offset indent
# pkill zfs-fuse
.Ed
.Pp
Further setup of file systems for use with Slash is necessary and can be
performed once the file system has been mounted by the metadata server.
.Ss Running Cm slashd Ns Ss ,\& the Metadata Server
.Xr slashd 8 ,
the Slash metadata server, must be started first.
.Xr slash 8
requires a pending operations journal for operation, which can be
created with the
.Xr slmkjrnl 8
utility:
.Bd -literal -offset indent
# slmkjrnl
.Ed



* The structure used to manage data about pending operations which need to be stored on disk can be created by running:

# odtable -C -N /var/lib/slashd/bmap_assignments.odt

Once the operating environment has been set up, launch the MDS server:

# LNET_NETWORKS="tcp10(eth0)" LNET_ACCEPT_PORT=1202 USOCK_CPORT=1202 \
slashd -f slash.conf

(Note: the USOCK_CPORT parameter specified above is for connections that slashd attempts to establish with I/O servers.)

After slashd has started, the ZFS namespace must be loaded:

# zpool import -c slpool.cf slpool

On new file system creation, the immutable namespace must be created:

# slimmns /slash

.Xr slctl 8
can be used to control operation of the client mount point.

.Ss Running Cm sliod Ns Ss ,\& the Tn Ss I/O Ss Server


Next, any I/O servers that need to be brought up can be at this point:

# SLASH_MDS_NID="128.182.58.86@tcp10" USOCK_CPORT=50001 \
LNET_NETWORKS="tcp10(eth0)" LNET_ACCEPT_PORT=1202 \
sliod -f slash.conf

Note: due to limitations in the Lustre networking stack, these daemons cannot be run to listen on the same interface with different TCP ports. Furthermore, due to limitations in the Slash protocols, interface alias addresses cannot be used either, as data is signed based on the assumption that clients have global addresses, a premise not true when connections are made across different network interfaces. Only virtual machines can facilitate an environment where all MD, I/O, and client can run together on the same machine; otherwise, the MD and I/O servers must reside on different hosts.

.Xr slioctl 8
can be used to control operation of the client mount point.

.Ss Running Cm mount_slash Ns Ss ,\& the Client Mount Daemon


Now launch the client mount points:

# SLASH_MDS_NID="10.32.5.82@tcp10" LNET_NETWORKS="tcp10(eth0)" \
USOCK_CPORT=1202 SLASH2_PIOS_ID="ion@mysite" \
mount_slash -U -f slash.conf /slash


.Xr msctl 8
can be used to control operation of the client mount point.

.Sh FILES
.Bl -tag -width 37n -compact
.It Pa /etc/slash.conf
site configuration
.It Pa /var/run/slashd. Ns Ic %h Ns Pa .sock
metadata daemon control socket
.It Pa /var/run/sliod. Ns Ic %h Ns Pa .sock
.Tn I/O
daemon control socket
.It Pa /var/run/mount_slash. Ns Ic %h Ns Pa .sock
client mount daemon control socket
.It Pa /var/lib/slashd/bmap_assignments.odt
.Tn I/O
server file block ownership
.It Pa /var/lib/slashd/slopjrnl
pending operations journal
.El
.Sh SEE ALSO
.Xr odtable 1 ,
.Xr slash.conf 5 ,
.Xr mount_slash 8 ,
.Xr msctl 8
.Xr slashd 8 ,
.Xr slctl 8 ,
.Xr slimmns 8 ,
.Xr slioctl 8 ,
.Xr sliod 8 ,
.Xr slmkjrnl 8 ,
.Xr zpool 8
