.\" $Id$
.Dd November 13, 2009
.Dt SLADM 7
.ds volume PSC \- SLASH Administrator's Manual
.Os http://www.psc.edu/
.Sh NAME
.Nm sladm
.Nd
.Tn SLASH
administration guide
.Sh DESCRIPTION
.Tn SLASH
is a distributed network file system featuring:
.Pp
.Bl -bullet -compact -offset indent
.It
replication
.It
data locality
.El
.Pp
This document describes the steps involving in creating and deploying a
.Tn SLASH
file system.
.Ss Creating a File System for SLASH Metadata
.Tn SLASH
uses
.Tn ZFS
for its backend metadata file system.
To create a new
.Tn ZFS
file system, launch the
.Xr zfs-fuse 8
daemon:
.Bd -literal -offset indent
# zfs-fuse
.Pp
.Ed
Next, create a
.Tn ZFS
pool with
.Xr zpool 8
which will be the master
.Tn ZFS
resource for use by the
.Tn SLASH
metadata server:
.Bd -literal -offset indent
# zpool create mypool sda		# single drive
# zpool create mypool mirror sda sdb	# two mirrored drives
.Ed
.Pp
To allow
.Tn ZFS
and
.Tn SLASH
to load this file system quickly, create a
cache dump file:
.Bd -literal -offset indent
# zpool set cachefile=/mypool.zcf mypool
.Ed
.Pp
Before this file system can be used by the
.Tn SLASH
metadata server, it needs to be initialized by
.Xr slimmns_format 8 :
.Bd -literal -offset indent
# slimmns_format /mypool
.Ed
.Pp
Now that the file system has been set up, the
.Xr zfs-fuse 8
daemon must be terminated before the
.Tn Slash
metadata server can access it:
.Bd -literal -offset indent
# umount /mypool
# pkill zfs-fuse
.Ed
.Ss Running Cm slashd Ns Ss ,\& the Metadata Server
.Xr slashd 8 ,
the
.Tn SLASH
metadata server, is the first daemon that should be started
when bringing up a
.Tn SLASH
file system.
In order to run,
.Xr slashd 8
requires an on-disk journal for resuming interrupted operations which
can be created with the
.Xr slmkjrnl 8
utility:
.Bd -literal -offset indent
# slmkjrnl -f
.Ed
.Pp
Next, an on-disk table for persistent storage of data pertaining to the
ownership of file blocks by
.Tn I/O
servers needs to be created with
.Xr odtable 1 :
.Bd -literal -offset indent
# odtable -C -N /var/lib/slashd/ion_bmaps.odt
.Ed
.Pp
Next, bring up
.Xr slashd 8 ,
the metadata server:
.Bd -literal -offset indent
# slashd -f slash.conf -c mypool.zcf mypool
.Ed
.Pp
.Xr slmctl 8
can be used to control live operation of
.Xr slashd 8
once it is running.
.Ss Running Cm sliod Ns Ss ,\& the Tn Ss I/O Ss Server
First, ensure the
.Tn I/O
server's file system has been initialized by
.Xr slimmns_format 8 :
.Bd -literal -offset indent
# slimmns_format -i fsroot
.Ed
.Pp
Now launch the
.Tn I/O
server
.Xr sliod 8
which manages this data store:
.Bd -literal -offset indent
# sliod -f slash.conf md@SITE
.Ed
.Pp
.Xr slictl 8
can be used to control live operation of the
.Tn I/O
server once it is running.
.Ss Running Cm mount_slash Ns Ss ,\& the Client Mount Server
.Xr mount_slash 8
is used to mount a
.Tn SLASH
file system to a point on the local system:
.Bd -literal -offset indent
# SLASH_MDS_NID="md@SITE" SLASH2_PIOS_ID="io@SITE" \e
  mount_slash -U -f slash.conf /myfs
.Ed
.Pp
.Xr msctl 8
can be used to control live operation of the client mount point once it
has been brought up.
.Sh CAVEATS
Running metadata and
.Tn I/O
servers on the same machine currently requires configuring each daemon
to listen on different addresses.
Furthermore, the network configuration must be such that each daemon can
access clients via the client destination network address.
.Pp
For example, setups where
.Xr slashd 8
residing on one network on
.Li eth0
reaches a client over a different client network address than
.Xr sliod 8
residing on a different network on
.Li eth1
will not work.
.Pp
The reason for this is because alternative
.Tn TCP
ports cannot be used for each of
.Xr slashd 8
and
.Xr sliod 8 ,
as
.Tn SLASH
utilizes the Lustre networking stack which does not easily
permit applications from connecting to multiple peers on differing
.Tn TCP
ports.
A single
.Tn TCP
port must be used globally for all daemons.
.El
.Sh SEE ALSO
.Xr odtable 1 ,
.Xr slash.conf 5 ,
.Xr pflenv 7 ,
.Xr mount_slash 8 ,
.Xr msctl 8
.Xr slashd 8 ,
.Xr slmctl 8 ,
.Xr slimmns 8 ,
.Xr slictl 8 ,
.Xr sliod 8 ,
.Xr slmkjrnl 8 ,
.Xr zpool 8
